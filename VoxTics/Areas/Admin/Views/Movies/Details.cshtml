@model VoxTics.Areas.Admin.ViewModels.Movie.MovieDetailViewModel
@using VoxTics.Models.Enums
@inject VoxTics.Helpers.ImgsHelper.ImageManager ImgManager

@{
    ViewData["Title"] = Model.Title;
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin/movies/movie-details.css" />
}

<div class="movie-details-container">
    <!-- Hero Section with Background -->
    <div class="hero-section">
        @{
            // Resolve main image
            string mainImg;
            if (!string.IsNullOrWhiteSpace(Model.MainImageUrl))
            {
                mainImg = Uri.IsWellFormedUriString(Model.MainImageUrl, UriKind.Absolute)
                ? Model.MainImageUrl
                : ImgManager.GetImageWebPath(ImageType.Movie, Model.Slug, Model.MainImageUrl);
            }
            else
            {
                mainImg = ImgManager.GetImageWebPath(ImageType.Movie, Model.Slug, null);
            }
        }

        <div class="hero-background" style="background-image: url('@mainImg');"></div>
        <div class="hero-overlay"></div>

        <div class="hero-content">
            <div class="breadcrumb-nav">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a asp-action="Index">
                                <i class="fas fa-film"></i>
                                Movies
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">@Model.Title</li>
                    </ol>
                </nav>
            </div>

            <div class="hero-actions">
                <div class="btn-group" role="group">
                    <a asp-action="Edit" asp-route-id="@Model.Id"
                       class="btn btn-primary"
                       data-tooltip="Edit movie details">
                        <i class="fas fa-edit"></i>
                        <span>Edit</span>
                    </a>
                    <a asp-action="Delete" asp-route-id="@Model.Id"
                       class="btn btn-danger"
                       data-tooltip="Delete this movie"
                       data-action="delete">
                        <i class="fas fa-trash"></i>
                        <span>Delete</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content-wrapper">
        <div class="movie-header">
            <div class="movie-title-section">
                <h1 class="movie-title">@Model.Title</h1>
                <div class="movie-meta">
                    <span class="meta-item category">
                        <i class="fas fa-tag"></i>
                        @Model.CategoryName
                    </span>
                    <span class="meta-separator">•</span>
                    <span class="meta-item release-date">
                        <i class="fas fa-calendar-alt"></i>
                        @Model.ReleaseDate.ToString("MMMM d, yyyy")
                    </span>
                    @if (Model.EndDate.HasValue)
                    {
                        <span class="meta-separator">-</span>
                        <span class="meta-item end-date">
                            @Model.EndDate.Value.ToString("MMMM d, yyyy")
                        </span>
                    }
                </div>

                <div class="movie-badges">
                    @if (Model.IsFeatured)
                    {
                        <span class="badge badge-featured">
                            <i class="fas fa-star"></i>
                            Featured
                        </span>
                    }
                    <span class="badge badge-status badge-@Model.Status.ToString().ToLower()">
                        <i class="fas fa-@(Model.Status == MovieStatus.NowShowing ? "play" : Model.Status == MovieStatus.Upcoming ? "clock" : "pause")"></i>
                        @Model.Status
                    </span>
                </div>
            </div>

            <div class="movie-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">@Model.Duration</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">@Model.Price.ToString("C")</div>
                        <div class="stat-label">Price</div>
                    </div>
                </div>

                @if (Model.Rating.HasValue)
                {
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value">@Model.Rating.Value.ToString("0.0")</div>
                            <div class="stat-label">Rating</div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="content-grid">
            <!-- Media Section -->
            <div class="media-section">
                <!-- Main Poster -->
                <div class="poster-container">
                    <div class="poster-wrapper">
                        <img src="@mainImg"
                             class="main-poster"
                             alt="@Model.Title poster"
                             loading="lazy"
                             onerror="this.onerror=null;this.src='@Url.Content("~/images/defaults/movie-placeholder.png")';" />
                        <div class="poster-overlay">
                            <button class="btn btn-play" onclick="openImageViewer('@mainImg')">
                                <i class="fas fa-expand-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Trailer Section -->
                @if (!string.IsNullOrWhiteSpace(Model.TrailerUrl) && Uri.IsWellFormedUriString(Model.TrailerUrl, UriKind.Absolute))
                {
                    <div class="trailer-section">
                        <h3 class="section-title">
                            <i class="fas fa-play-circle"></i>
                            Trailer
                        </h3>
                        <div class="trailer-container">
                            <div class="video-wrapper">
                                <iframe src="@Model.TrailerUrl"
                                        title="Trailer for @Model.Title"
                                        allowfullscreen
                                        loading="lazy"></iframe>
                                <div class="video-overlay">
                                    <button class="play-button">
                                        <i class="fas fa-play"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!-- Gallery Section -->
                @if (Model.AdditionalImageUrls?.Any() == true)
                {
                    <div class="gallery-section">
                        <h3 class="section-title">
                            <i class="fas fa-images"></i>
                            Gallery
                            <span class="count">(@Model.AdditionalImageUrls.Count())</span>
                        </h3>
                        <div class="gallery-grid">
                            @foreach (var img in Model.AdditionalImageUrls.Take(6))
                            {
                                var url = Uri.IsWellFormedUriString(img, UriKind.Absolute)
                                ? img
                                : ImgManager.GetImageWebPath(ImageType.Movie, Model.Slug, img);

                                <div class="gallery-item">
                                    <img src="@url"
                                         alt="@Model.Title gallery image"
                                         class="gallery-image"
                                         loading="lazy"
                                         onclick="openImageViewer('@url')"
                                         onerror="this.onerror=null;this.src='@Url.Content("~/images/defaults/placeholder.png")';" />
                                    <div class="gallery-overlay">
                                        <i class="fas fa-expand"></i>
                                    </div>
                                </div>
                            }

                            @if (Model.AdditionalImageUrls.Count() > 6)
                            {
                                <div class="gallery-item more-images">
                                    <div class="more-overlay">
                                        <i class="fas fa-plus"></i>
                                        <span>+@(Model.AdditionalImageUrls.Count() - 6)</span>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <!-- Details Section -->
            <div class="details-section">
                <!-- Description -->
                <div class="description-card">
                    <h3 class="section-title">
                        <i class="fas fa-align-left"></i>
                        Synopsis
                    </h3>
                    <div class="description-content">
                        <p>@Model.Description</p>
                    </div>
                </div>

                <!-- Movie Information -->
                <div class="info-card">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle"></i>
                        Movie Information
                    </h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-user-tie"></i>
                                Director
                            </div>
                            <div class="info-value">@Model.Director</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-calendar-alt"></i>
                                Release Date
                            </div>
                            <div class="info-value">@Model.ReleaseDate.ToString("MMMM d, yyyy")</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-clock"></i>
                                Duration
                            </div>
                            <div class="info-value">@Model.Duration minutes</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-dollar-sign"></i>
                                Price
                            </div>
                            <div class="info-value">@Model.Price.ToString("C")</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-star"></i>
                                Rating
                            </div>
                            <div class="info-value">
                                @if (Model.Rating.HasValue)
                                {
                                    <div class="rating-display">
                                        <span class="rating-value">@Model.Rating.Value.ToString("0.0")</span>
                                        <div class="stars">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <i class="fas fa-star @(i <= Math.Floor(Model.Rating.Value) ? "filled" : "")"></i>
                                            }
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <span class="no-rating">Not rated</span>
                                }
                            </div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-language"></i>
                                Language
                            </div>
                            <div class="info-value">@Model.Language</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-globe"></i>
                                Country
                            </div>
                            <div class="info-value">@(Model.Country ?? "Not specified")</div>
                        </div>

                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-flag"></i>
                                Status
                            </div>
                            <div class="info-value">
                                <span class="status-indicator status-@Model.Status.ToString().ToLower()">
                                    @Model.Status
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="actions-card">
                    <div class="action-buttons">
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary btn-lg">
                            <i class="fas fa-edit"></i>
                            Edit Movie
                        </a>
                        <a asp-action="Delete" asp-route-id="@Model.Id"
                           class="btn btn-danger btn-lg"
                           data-action="delete">
                            <i class="fas fa-trash"></i>
                            Delete Movie
                        </a>
                        <a asp-action="Index" class="btn btn-secondary btn-lg">
                            <i class="fas fa-arrow-left"></i>
                            Back to List
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Image Viewer Modal -->
<div class="image-viewer-modal" id="imageViewer">
    <div class="viewer-backdrop"></div>
    <div class="viewer-content">
        <div class="viewer-header">
            <h3 class="viewer-title">@Model.Title</h3>
            <div class="viewer-controls">
                <button class="btn btn-viewer" id="downloadBtn" title="Download image">
                    <i class="fas fa-download"></i>
                </button>
                <button class="btn btn-viewer" id="fullscreenBtn" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="btn btn-viewer" id="closeViewer" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="viewer-body">
            <img id="viewerImage" src="" alt="Movie image" />
            <div class="viewer-loading">
                <div class="spinner"></div>
            </div>
        </div>
        <div class="viewer-footer">
            <div class="viewer-nav">
                <button class="btn btn-nav" id="prevImage" title="Previous image">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="image-counter">1 / 1</span>
                <button class="btn btn-nav" id="nextImage" title="Next image">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Floating Action Button (Mobile) -->
<div class="fab-container">
    <button class="fab" id="fabMenu">
        <i class="fas fa-ellipsis-v"></i>
    </button>
    <div class="fab-menu">
        <a asp-action="Edit" asp-route-id="@Model.Id" class="fab-item" title="Edit">
            <i class="fas fa-edit"></i>
        </a>
        <a asp-action="Delete" asp-route-id="@Model.Id" class="fab-item" title="Delete" data-action="delete">
            <i class="fas fa-trash"></i>
        </a>
        <a asp-action="Index" class="fab-item" title="Back">
            <i class="fas fa-arrow-left"></i>
        </a>
    </div>
</div>

@section Scripts {
    <script src="~/js/admin/movies/movie-details.js"></script>
}