@model VoxTics.Areas.Admin.ViewModels.MovieViewModel

@{
    ViewData["Title"] = "Movies";
}

<h2>Movies</h2>

<div class="mb-3 row">
    <div class="col-md-3">
        <input type="text" id="searchTerm" class="form-control" placeholder="Search by title..." value="@Model.SearchTerm" />
    </div>
    <div class="col-md-3">
        <select id="categoryFilter" class="form-select">
            @foreach (var cat in Model.CategoryOptions)
            {
                <option value="@cat.Value" selected="@(cat.Selected ? "selected" : "")">@cat.Text</option>
            }
        </select>
    </div>
    <div class="col-md-3">
        <select id="statusFilter" class="form-select">
            @foreach (var status in Model.StatusOptions)
            {
                <option value="@status.Value" selected="@(status.Selected ? "selected" : "")">@status.Text</option>
            }
        </select>
    </div>
    <div class="col-md-3 text-end">
        <button class="btn btn-primary" id="btnCreateMovie">Add Movie</button>
    </div>
</div>

<div id="moviesTableContainer">
    @await Html.PartialAsync("_MoviesTable", Model)
</div>

<!-- Modal -->
<div class="modal fade" id="movieModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" id="movieModalContent"></div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {

            // Filters
            $("#searchTerm, #categoryFilter, #statusFilter").on("change keyup", function() {
                loadMovies();
            });

            // Create
            $("#btnCreateMovie").click(function() {
                $.get('@Url.Action("Create")', function(data) {
                    $("#movieModalContent").html(data);
                    $("#movieModal").modal("show");
                });
            });

            // Load movies table via AJAX
            function loadMovies(page = 1) {
                var searchTerm = $("#searchTerm").val();
                var categoryId = $("#categoryFilter").val();
                var status = $("#statusFilter").val();

                $.get('@Url.Action("Index")', { searchTerm, categoryId, page }, function(data) {
                    $("#moviesTableContainer").html(data);
                });
            }

            // Pagination click
            $(document).on("click", ".page-link", function(e) {
                e.preventDefault();
                var page = $(this).data("page");
                loadMovies(page);
            });
        });
    </script>
}
