@model VoxTics.Models.ViewModels.BookingVM

@{
    ViewData["Title"] = "Book Tickets";
    var availableSeats = (List<dynamic>)ViewData["AvailableSeats"];
}

<h2>@ViewData["Title"] for @Model.MovieTitle</h2>

<div>
    <p><strong>Cinema:</strong> @Model.CinemaName</p>
    <p><strong>Hall:</strong> @Model.HallName</p>
    <p><strong>Showtime:</strong> @Model.ShowtimeStart.ToString("g")</p>
    <p><strong>Price per seat:</strong> @Model.TotalPrice.ToString("C")</p>
</div>

<form id="bookingForm" method="post" asp-action="CreateBooking" asp-controller="Booking">
    <input type="hidden" name="showtimeId" value="@Model.ShowtimeId" />

    <div class="mb-3">
        <label>Select Seats</label>
        <div class="d-flex flex-wrap gap-2">
            @foreach (var seat in availableSeats)
            {
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="selectedSeatIds" value="@seat.id" id="seat_@seat.id">
                    <label class="form-check-label" for="seat_@seat.id">@seat.number</label>
                </div>
            }
        </div>
    </div>

    <button type="submit" class="btn btn-success">Book Tickets</button>
</form>

@section Scripts {
    <script>
        $("#bookingForm").on("submit", function (e) {
            e.preventDefault();
            var form = $(this);
            $.post(form.attr("action"), form.serialize())
                .done(function (data) {
                    if (data.success) {
                        alert("Booking successful! Booking # " + data.bookingNumber);
                        window.location.href = '/Booking';
                    } else {
                        alert(data.message);
                    }
                });
        });
    </script>
}
