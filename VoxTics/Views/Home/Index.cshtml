@model VoxTics.Models.ViewModels.Home.HomeVM
@using System.Linq



<div class="container-fluid">
    <!-- Apple Keyboard+ Hero Section -->
    <div class="home-hero">
        <div class="home-hero-content">
            <h1>Welcome to VoxTics Cinema</h1>
            <p>Discover the latest movies and find your perfect cinema experience</p>
        </div>
    </div>

    <!-- Apple Keyboard+ Search Section -->
    <div class="container">
        <div class="search-container mx-auto mb-5" style="max-width: 600px;">
            <form class="search-form" method="get" asp-controller="Movies" asp-action="Index">
                <i class="bi bi-search search-icon"></i>
                <input type="search" name="search" class="search-input"
                       placeholder="Search for movies, cinemas, or showtimes..."
                       value="@Context.Request.Query["search"]" id="searchInput" />
                <button class="search-btn" type="submit">
                    <i class="bi bi-arrow-right"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Featured Movies -->
    <div class="container mb-5">
        <div class="section-header text-center mb-4">
            <h2 class="section-title">🎬 Featured Movies</h2>
            <p class="section-subtitle">Handpicked selections just for you</p>
        </div>
        
        <div class="movies-grid" id="featuredMovies">
            @foreach (var movie in Model.Featured)
            {
                <div class="movie-card animate-fade-in-up" data-movie="@movie.Title">
                    <div class="movie-poster-container">
                        <img src="@movie.MainImageUrl"
                             class="movie-poster"
                             alt="@movie.Title"
                             onerror="this.onerror=null;this.src='@Url.Content("~/images/placeholder.svg")';" />
                        <div class="movie-overlay">
                            <button class="play-button">
                                <i class="bi bi-play-fill"></i>
                            </button>
                        </div>
                        <div class="movie-badges">
                            <span class="movie-badge featured">Featured</span>
                        </div>
                    </div>
                    
                    <div class="movie-content">
                        <h5 class="movie-title">@movie.Title</h5>
                        <div class="movie-meta">
                            <div class="meta-item">
                                <i class="bi bi-star-fill meta-icon"></i>
                                <span>@(new Random().Next(35, 50) / 10.0)</span>
                            </div>
                            <div class="meta-item">
                                <i class="bi bi-clock meta-icon"></i>
                                <span>2h 15m</span>
                            </div>
                        </div>
                        <div class="movie-actions">
                            <a href="@Url.Action("Details", "Movies", new { id = movie.Id })" class="btn-book">Book Now</a>
                            <a href="@Url.Action("Details", "Movies", new { id = movie.Id })" class="btn-details">Details</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Now Showing -->
    <div class="container mb-5">
        <div class="section-header text-center mb-4">
            <h3 class="section-title">🎭 Now Showing</h3>
            <p class="section-subtitle">Currently playing at your favorite theaters</p>
        </div>
        
        <div class="card">
            <div class="card-body p-0">
                @foreach (var movie in Model.NowShowing)
                {
                    <div class="list-apple-item" onclick="selectMovie('@movie.Title')">
                        <div class="flex-grow-1">
                            <h6 class="text-primary fw-semibold mb-1">@movie.Title</h6>
                            <div class="text-secondary small">
                                <i class="bi bi-clock me-1"></i>
                                Showtimes: 2:30 PM, 6:00 PM, 9:30 PM
                            </div>
                        </div>
                        <span class="badge badge-success">Now Playing</span>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Coming Soon -->
    <div class="container mb-5">
        <div class="section-header text-center mb-4">
            <h3 class="section-title">🚀 Coming Soon</h3>
            <p class="section-subtitle">Get ready for these upcoming blockbusters</p>
        </div>
        
        <div class="card">
            <div class="card-body p-0">
                @foreach (var movie in Model.ComingSoon)
                {
                    <div class="list-apple-item" onclick="selectMovie('@movie.Title')">
                        <div class="flex-grow-1">
                            <h6 class="text-primary fw-semibold mb-1">@movie.Title</h6>
                            <div class="text-secondary small">
                                <i class="bi bi-calendar me-1"></i>
                                Release date coming soon
                            </div>
                        </div>
                        <span class="badge badge-warning">Coming Soon</span>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Cinemas -->
    <div class="container mb-5">
        <div class="section-header text-center mb-4">
            <h3 class="section-title">🎪 Our Cinemas</h3>
            <p class="section-subtitle">Premium locations for the ultimate movie experience</p>
        </div>
        
        <div class="cinema-grid">
            @foreach (var cinema in Model.Cinemas)
            {
                <div class="cinema-card animate-fade-in-up" onclick="selectCinema('@cinema.Name')">
                    <div class="cinema-icon">
                        <i class="bi bi-building"></i>
                    </div>
                    <h5 class="cinema-name">@cinema.Name</h5>
                    <div class="cinema-location">
                        <i class="bi bi-geo-alt"></i>
                        <span>@cinema.Country</span>
                    </div>
                    <div class="cinema-actions">
                        <a href="@Url.Action("Details", "Cinemas", new { id = cinema.Id })" class="btn btn-primary">View Details</a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@* Styles are now handled by the unified Apple Keyboard+ Design System *@

<script>
document.addEventListener('DOMContentLoaded', function() {
    setupEventListeners();
});

function setupEventListeners() {
    // Search functionality
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch(e.target.value);
            }, 300);
        });
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'k') {
            e.preventDefault();
            searchInput?.focus();
        }
    });
}

function performSearch(searchTerm) {
    const term = searchTerm.toLowerCase().trim();
    const movieCards = document.querySelectorAll('.movie-card');
    const listItems = document.querySelectorAll('.list-apple-item');
    const cinemaCards = document.querySelectorAll('.cinema-card');

    let visibleCount = 0;

    // Search movie cards
    movieCards.forEach(card => {
        const title = card.dataset.movie?.toLowerCase() || '';
        const isVisible = !term || title.includes(term);
        card.closest('.col-lg-4, .col-md-6').style.display = isVisible ? '' : 'none';
        if (isVisible) visibleCount++;
    });

    // Search list items
    listItems.forEach(item => {
        const title = item.querySelector('h6')?.textContent.toLowerCase() || '';
        const isVisible = !term || title.includes(term);
        item.style.display = isVisible ? '' : 'none';
        if (isVisible) visibleCount++;
    });

    // Search cinema cards
    cinemaCards.forEach(card => {
        const name = card.querySelector('h5')?.textContent.toLowerCase() || '';
        const location = card.querySelector('span')?.textContent.toLowerCase() || '';
        const isVisible = !term || name.includes(term) || location.includes(term);
        card.closest('.col-lg-4, .col-md-6').style.display = isVisible ? '' : 'none';
        if (isVisible) visibleCount++;
    });

    // Show search feedback
    if (term && visibleCount === 0) {
        showNotification(`No results found for "${searchTerm}"`, 'warning');
    } else if (term) {
        showNotification(`Found ${visibleCount} results for "${searchTerm}"`, 'info');
    }
}

function selectMovie(movieTitle) {
    showNotification(`Selected: ${movieTitle}`, 'success');
    // Add navigation logic here
    console.log('Navigate to movie:', movieTitle);
}

function selectCinema(cinemaName) {
    showNotification(`Selected cinema: ${cinemaName}`, 'success');
    // Add navigation logic here
    console.log('Navigate to cinema:', cinemaName);
}

function showNotification(message, type = 'info') {
    // Use the global notification system from notification.css
    const notification = document.createElement('div');
    notification.className = `notification notification-apple notification-apple-${type}`;
    
    const content = document.createElement('div');
    content.className = 'notification-content';
    content.innerHTML = `<div class="notification-message">${message}</div>`;
    
    notification.appendChild(content);
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.classList.add('hiding');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}
</script>