@* Views/Shared/_Loader.cshtml *@
<div id="global-loader" aria-hidden="true" class="global-loader d-none">
    <div class="global-loader-overlay"></div>
    <div class="global-loader-content" role="status" aria-live="polite">
        <div class="spinner">
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>
        <div class="loader-message">Loading…</div>
    </div>
</div>


@section Styles {
    <style>
/* wwwroot/css/loader.css */
.global-loader {
  position: fixed;
  inset: 0; /* top:0; right:0; bottom:0; left:0; */
  z-index: 20000; /* high so it's above modals */
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none; /* allow clicks through when hidden; JS toggles visibility */
}

.global-loader:not(.d-none) {
  pointer-events: auto;
}

/* translucent overlay */
.global-loader-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(1px);
}

/* content card */
.global-loader-content {
  position: relative;
  z-index: 20001;
  background: rgba(255,255,255,0.98);
  padding: 18px 22px;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 160px;
  max-width: 90%;
}

/* spinner (simple CSS double bounce) */
.spinner {
  width: 40px;
  height: 40px;
  position: relative;
}
.double-bounce1, .double-bounce2 {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  opacity: 0.75;
  position: absolute;
  top: 0;
  left: 0;
  -webkit-animation: sk-bounce 2.0s infinite ease-in-out;
          animation: sk-bounce 2.0s infinite ease-in-out;
  background: linear-gradient(135deg, #007bff 0%, #00a3ff 100%);
}
.double-bounce2 {
  -webkit-animation-delay: -1.0s;
          animation-delay: -1.0s;
}

@@-webkit-keyframes sk-bounce {
  0%, 100% { -webkit-transform: scale(0.0) }
  50% { -webkit-transform: scale(1.0) }
}
@@keyframes sk-bounce {
  0%, 100% { transform: scale(0.0); -webkit-transform: scale(0.0) }
  50% { transform: scale(1.0); -webkit-transform: scale(1.0) }
}

.loader-message {
  font-size: 0.95rem;
  color: #1f2937; /* dark gray */
}

/* small screens tweak */
@@media (max-width: 420px) {
  .global-loader-content { padding: 12px; gap: 8px; }
  .spinner { width: 32px; height: 32px; }
}

    </style>
}

@section Scripts {
    <script>
         // wwwroot/js/loader.js
        (function () {
            const $ = window.jQuery;
            const loaderSelector = '#global-loader';
            const hideClass = 'd-none';

            function getEl() {
                return document.querySelector(loaderSelector);
            }

            function show() {
                const el = getEl();
                if (!el) return;
                el.classList.remove(hideClass);
            }

            function hide() {
                const el = getEl();
                if (!el) return;
                el.classList.add(hideClass);
            }

            // Expose API
            window.Loader = {
                show,
                hide,
                toggle: function(showing) {
                    if (showing) show(); else hide();
                }
            };

            // If jQuery present, hook global ajax events
            if ($) {
                // Show when any ajax starts
                $(document).ajaxStart(function () {
                    show();
                });

                // Hide when all done
                $(document).ajaxStop(function () {
                    hide();
                });

                // In case of error also hide after a small delay
                $(document).ajaxError(function () {
                    setTimeout(hide, 200);
                });
            }

            // Wrap fetch (very small wrapper) to show loader while fetch is in progress
            // Use window.fetchWithLoader(...) in your code instead of fetch
            window.fetchWithLoader = function (input, init) {
                show();
                return fetch(input, init)
                    .then(function (res) {
                        // keep loader visible a little if you want smoother UX
                        setTimeout(hide, 150);
                        return res;
                    })
                    .catch(function (err) {
                        setTimeout(hide, 150);
                        throw err;
                    });
            };

            // Show loader on beforeunload to give immediate feedback on full-page navigation
            window.addEventListener('beforeunload', function () {
                // Don't block unload; only visual feedback
                show();
            });

            // Optionally hide loader when window loaded (in case you want a small preload splash)
            window.addEventListener('load', function () {
                hide();
            });

        })();
    </script>
}
